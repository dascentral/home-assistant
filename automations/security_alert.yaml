---
# Automation: Security Alert
# Sends notifications when doors/windows are opened while away or at night
# Update sensor entity IDs for your doors and windows

- id: 'security_alert'
  alias: 'Security Alert'
  description: 'Notify when doors or windows opened unexpectedly'
  
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.front_door
        - binary_sensor.back_door
        - binary_sensor.garage_door
      to: 'on'
  
  condition:
    - condition: or
      conditions:
        # Alert when away
        - condition: state
          entity_id: input_boolean.away_mode
          state: 'on'
        
        # Alert at night (11 PM - 6 AM)
        - condition: and
          conditions:
            - condition: time
              after: '23:00:00'
              before: '06:00:00'
            - condition: state
              entity_id: alarm_control_panel.home_alarm
              state: 'armed_night'
  
  action:
    - service: notify.mobile_app
      data:
        title: "ðŸš¨ Security Alert"
        message: >
          {{ trigger.to_state.attributes.friendly_name }} was opened at {{ now().strftime('%I:%M %p') }}
        data:
          priority: high
          ttl: 0
          channel: security
    
    # Turn on all lights as deterrent
    - service: light.turn_on
      target:
        entity_id: all
      data:
        brightness_pct: 100
    
    # Optional: Sound alarm or siren
    # - service: switch.turn_on
    #   target:
    #     entity_id: switch.alarm_siren
